#define BLYNK_PRINT Serial
#include <ESP8266WiFi.h>
#include <BlynkSimpleEsp8266.h>
#include <DHT.h>

char auth[] = "YOUR_BLYNK_AUTH_TOKEN";
char ssid[] = "YOUR_WIFI_SSID";
char pass[] = "YOUR_WIFI_PASSWORD";

#define DHTPIN D2
#define DHTTYPE DHT22
#define SOIL_MOISTURE_PIN A0
#define LDR_PIN D7               // LDR sebagai input digital
#define PUMP_PIN D5
#define LED_PIN D6

DHT dht(DHTPIN, DHTTYPE);
const int soilThreshold = 500;

void setup() {
  Serial.begin(9600);
  Blynk.begin(auth, ssid, pass);
  dht.begin();

  pinMode(PUMP_PIN, OUTPUT);
  pinMode(LED_PIN, OUTPUT);
  pinMode(LDR_PIN, INPUT);
}

void loop() {
  Blynk.run();

  float temp = dht.readTemperature();
  float hum = dht.readHumidity();
  int soil = analogRead(SOIL_MOISTURE_PIN);
  int light = digitalRead(LDR_PIN);  // Baca terang/gelap

  // Kirim ke Blynk
  Blynk.virtualWrite(V0, temp);
  Blynk.virtualWrite(V1, hum);
  Blynk.virtualWrite(V2, soil);
  Blynk.virtualWrite(V3, light);

  // Kontrol Pompa
  if (soil > soilThreshold) {
    digitalWrite(PUMP_PIN, HIGH);
    Blynk.virtualWrite(V4, "Pompa ON - Tanah Kering");
  } else {
    digitalWrite(PUMP_PIN, LOW);
    Blynk.virtualWrite(V4, "Pompa OFF - Tanah Lembab");
  }

  // Kontrol LED dari LDR
  if (light == HIGH) {
    digitalWrite(LED_PIN, HIGH);
    Blynk.virtualWrite(V5, "Cahaya Kurang - LED ON");
  } else {
    digitalWrite(LED_PIN, LOW);
    Blynk.virtualWrite(V5, "Cahaya Cukup - LED OFF");
  }

  delay(2000);  // Delay antar pembacaan
}
